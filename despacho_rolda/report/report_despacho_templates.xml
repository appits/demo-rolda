<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="despacho_layout_standard">
    <t t-if="not o" t-set="o" t-value="doc"/>
    <t t-if="not company">
      <!-- Multicompany -->
      <t t-if="company_id">
        <t t-set="company" t-value="company_id"/>
      </t>
      <t t-elif="o and 'company_id' in o">
        <t t-set="company" t-value="o.company_id.sudo()"/>
      </t>
      <t t-else="else">
        <t t-set="company" t-value="res_company"/>
      </t>
    </t>
    <div t-attf-class="header o_company_#{company.id}_layout" t-att-style="report_header_style">
      <div class="row">
        <div class="col-4 mb4">
          <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" style="max-height: 85px;" alt="Logo"/>
          <div><t t-esc="company.country_id.vat_label or 'R.I.F.'"/>: <span t-field="company.vat"/></div>
        </div>
        <div t-esc="title" class="h3 col-4 text-center font-weight-bold" style="margin-top:42px;"/>
        <div t-esc="left_header" class="col-4 text-right font-weight-bold" style="margin-top:22px;"/>
        <div t-if="report_type == 'pdf'" class="text-muted">
          Página: <span class="page"/> de <span class="topage"/>
        </div>
      </div>
      <div class="row">
        <div class="col-12" name="company_address">
          <div><span t-field="company.partner_id.name"/>, T.L.F.: <span t-field="company.phone"/></div>
          <div t-field="company.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": true}'/>
        </div>
      </div>
    </div>

    <div t-attf-class="article o_report_layout_standard o_company_#{company.id}_layout"  t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
      <t t-call="web.address_layout"/>
      <t t-raw="0"/>
    </div>

    <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
      <div>
        <div name="sign_infos">
          <span>Observaciones Generales: <span t-esc="despacho['notes']"/> </span><span>Precinto: <span t-esc="seal"/></span>
          <table class="table table-rolda-footer" style="page-break-inside: avoid; font-size: 80%;">
            <tr>
              <td class="w-20">Aprobación logística</td>
              <td class="w-20">Preparador</td>
              <td class="w-20">Chequeador</td>
              <td class="w-20">Conforme transportista</td>
              <td class="w-20">Retorno de facturas despachadas</td>
            </tr>
            <tr>
              <td class="py-4"/>
              <td class="py-4"/>
              <td class="py-4"/>
              <td class="py-4"/>
              <td class="py-4"/>
            </tr>
            <tr>
              <td class="">FECHA:</td>
              <td class="">FECHA:</td>
              <td class="">FECHA:</td>
              <td class="">FECHA:</td>
              <td class="">FECHA:</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </template>

  <template id="report_despacho_consolidated_document">
    <t t-call="web.html_container">
      <t t-call="despacho_rolda.despacho_layout_standard">
        <t t-set="title" t-value="'GUÍA DE DESPACHO'"/>
        <t t-set="left_header" t-value="'Número de Guía: {}'.format(despacho['name'])"/>
        <t t-set="seal" t-value="despacho['seal']"/>
        <div class="oe_structure"/>
        <div class="page">
          <table class="table table-bordered border-black">
            <tr>
              <td><strong>Compañía de transporte:</strong> <span t-esc="despacho['transport_name']"/></td>
              <td><strong>Vehículo:</strong> <span t-esc="despacho['license']"/></td>
            </tr>
            <tr>
              <td><strong>Chofer:</strong> <span t-esc="despacho['driver_name']"/></td>
              <td><strong>Ayudante:</strong> <span t-esc="despacho['assistant_name']"/></td>
            </tr>
            <tr>
              <td><strong>C.I.:</strong> <span t-esc="despacho['driver_vat']"/></td>
              <td><strong>C.I.:</strong> <span t-esc="despacho['assistant_vat']"/></td>
            </tr>
          </table>
          <table class="table table-despacho">
            <thead>
              <tr>
                <th class="text-left"><span>Nro. Factura</span></th>
                <th class="text-left"><span>Cliente</span></th>
                <th class="text-left"><span>Ciudad</span></th>
                <th class="text-left text-nowrap"><span>Bultos</span></th>
                <th class="text-left"><span>Kg.</span></th>
                <th class="text-left"><span>Observaciones</span></th>
              </tr>
            </thead>
            <tbody>
              <t t-set="total_weight" t-value="0.0"/>
              <t t-set="total_rows" t-value="len(despacho['lines'])"/>
              <t t-foreach="despacho['lines']" t-as="line">
                <tr>
                  <td class="text-center"><span t-esc="line['name']"/></td>
                  <td><span t-esc="line['partner_name']"/></td>
                  <td><span t-esc="line['partner_city']"/></td>
                  <td class="text-right"><span t-esc="line['quantity']"/></td>
                  <td class="text-right"><span t-esc="line['weight']"/></td>
                  <td class="border-top-0"/>
                  <!-- <td t-att-rowspan="total_rows"><span t-esc="despacho['notes']" t-options="{'widget': 'text'}"/></td> -->
                </tr>
                <t t-set="total_weight" t-value="total_weight + line['weight']"/>
              </t>
            </tbody>
          </table>
          <div class="w-75 text-right">
            <span>Peso Total: <t t-esc="'{:,.2f}'.format(total_weight)"/></span>
          </div>
        </div>
      </t>
    </t>
  </template>
</odoo>
